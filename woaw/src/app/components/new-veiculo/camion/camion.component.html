<section>
  <!-- ===== Resumen arriba (botón publicar + preview estado) ===== -->
  <div class="resumen-estado" *ngIf="seccionFormulario == 2 && Pregunta == 'no'">


    <button type="button" class="btn-guardar" (click)="EnviarCamion()">
      <ion-icon name="save-outline" class="icono-guardar"></ion-icon>
      Publicar
    </button>


    <div class="fila-info">
      <p>Año: <strong>{{ anio }}</strong></p>
      <p>Marca: <strong>{{ marca }}</strong></p>
      <p>Modelo: <strong>{{ modelo }}</strong></p>
      <p class="estilo_unico">{{ estadoCamion }}</p>
    </div>
  </div>

  <!-- ===== PREGUNTA tipo de camión (particular/lote/empresa) ===== -->

  <div class="tipo-vehiculo-container" *ngIf="Pregunta == 'si'">
    <h2 class="titulo-tipo">¿Qué tipo de camión quieres subir?</h2>

    <div class="opciones-vehiculo">
      <div class="casilla" [class.activa]="tipoSeleccionado === 'particular'" (click)="seleccionarTipo('particular')">
        <img src="assets/img/particular.png" alt="Particular" />
        <p>Particular</p>
        <ion-icon *ngIf="tipoSeleccionado === 'particular'" name="checkmark-circle-outline"
          class="icono-check"></ion-icon>
      </div>

      <div class="casilla" [class.activa]="tipoSeleccionado === 'lote'" (click)="seleccionarTipo('lote')">
        <img src="assets/img/lote.png" alt="Lote" />
        <p>Lote</p>
        <ion-icon *ngIf="tipoSeleccionado === 'lote'" name="checkmark-circle-outline" class="icono-check"></ion-icon>
      </div>
    </div>

    <div class="contenedor-boton">
      <button class="btn-continuar" [disabled]="!tipoSeleccionado" (click)="continuar()">
        Continuar <ion-icon name="arrow-forward-outline"></ion-icon>

      </button>
    </div>
  </div>


  <!-- ===== PREGUNTA "Quién lo vende" (solo particular no-admin) ===== -->

  <div *ngIf="tipoSeleccionado == 'particular' && MyRole !== 'admin' && seccionFormulario == 1"
    class="pregunta-vendedor">
    <p class="texto-pregunta">¿Cómo quieres vender tu camión?</p>
    <div class="botones-vendedor">
      <button class="btn-vender-yo" (click)="quienLovende(0)">Lo vendo yo</button>
      <button class="btn-vende-go" (click)="quienLovende(1)">
        Que lo venda <img src="assets/icon/logo4.png" alt="Go Transportes" class="logo-boton" />
      </button>
    </div>
  </div>

  <!-- ===== Opción de que Go lo publique ===== -->
  <div
    *ngIf="tipoSeleccionado === 'particular' && seccionFormulario === 3 && (MyRole === 'cliente' || MyRole === 'transportista')"
    class="formulario-publicacion">

    <p class="info-texto">
      <strong>¡Nosotros nos encargamos!</strong> Publicamos tu camion y agendamos citas con interesados.
      <br />
      <strong>Contáctanos por WhatsApp y te ayudamos.</strong>
    </p>

    <div class="info-grid">
      <p>Año: <strong>{{ anio }}</strong></p>
      <p>Marca: <strong>{{ marca }}</strong></p>
      <p>Modelo: <strong>{{ modelo }}</strong></p>
      <p class="estilo_unico">{{ estadoCamion }}</p>
    </div>

    <ion-item>
      <ion-label position="stacked">Precio estimado (opcional)</ion-label>
      <ion-input type="number" placeholder="Solo números" [(ngModel)]="precioEstimado"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Tipo de factura (opcional)</ion-label>
      <ion-select [(ngModel)]="tipoFactura" placeholder="Selecciona una opción">
        <ion-select-option value="original">Original</ion-select-option>
        <ion-select-option value="refacturada">Refacturada</ion-select-option>
        <ion-select-option value="sin factura">Sin factura</ion-select-option>
      </ion-select>
    </ion-item>

    <div class="btn-wsp-container">
      <button class="btn-wsp" (click)="contactosService.contactarPorPublicacionParticular(
        anio,
        marca,
        modelo,
        precioEstimado!,
        tipoFactura
      )">
        <ion-icon name="logo-whatsapp" slot="start"></ion-icon>
        Contáctanos por WhatsApp
      </button>
    </div>
    
  </div>

  <!-- ===== FORMULARIO PRINCIPAL ===== -->
  <div class="formulario" *ngIf="Pregunta == 'no' && seccionFormulario == 2">
    <div class="contenedor-botones">
      <!-- Ubicación (particular) -->

      <div class="bloque-imagenes" *ngIf="tipoSeleccionado == 'particular'">
        <button type="button" (click)="seleccionarUbicacion()">
          <ion-icon name="location-outline" class="icono"></ion-icon>
          Seleccionar ubicación
        </button>

        <div *ngIf="ubicacionSeleccionada" class="ubicacion-mostrada">
          <ion-icon name="location-outline"></ion-icon>
          {{ direccionCompleta }}
        </div>
      </div>

      <!-- Lote  -->
      <div class="bloque-imagenes" *ngIf="tipoSeleccionado === 'lote' ">
        <label for="loteSelect">Selecciona tu lote:</label>
        <select id="loteSelect" [(ngModel)]="loteSeleccionado" (change)="onLoteSeleccionado()" class="select-lote">
          <option [ngValue]="null" disabled selected>Selecciona un lote</option>
          <option *ngFor="let lote of lotes" [ngValue]="lote._id">{{ lote.nombre }}</option>
        </select>

        <div *ngIf="ubicacionesLoteSeleccionado.length > 1" class="bloque-direcciones">
          <label for="direccionSelect">Selecciona una ubicación:</label>
          <select id="direccionSelect" [(ngModel)]="direccionSeleccionada" class="select-lote">
            <option [ngValue]="null" disabled selected>Selecciona una ubicación</option>
            <option *ngFor="let dir of ubicacionesLoteSeleccionado; let i = index" [ngValue]="dir">

              {{ ubicacionesLoteLegibles[i] || 'Obteniendo dirección...' }}
            </option>
          </select>
        </div>


        <div *ngIf="direccionSeleccionada && ubicacionesLoteSeleccionado.length === 1" class="ubicacion-mostrada">
          <ion-icon name="location-outline"></ion-icon>
          <span>{{ direccionCompleta }}</span>
        </div>
      </div>

      <!-- Imágenes -->

      <div class="bloque-imagenes">
        <button class="btn-imagenes" type="button" (click)="seleccionarImagenes()">
          <ion-icon name="image-outline"></ion-icon>
          Seleccionar Imágenes
          <label class="radio-validacion" [class.activo]="imagenesValidas" [class.inactivo]="!imagenesValidas">
            <span class="radio-custom"></span>
            <ion-icon name="checkmark-outline"></ion-icon>
          </label>
        </button>

        <button *ngIf="imagenesIntentadas" class="btn-limpiar" type="button" (click)="limpiarImagenes()">
          <ion-icon name="trash-outline"></ion-icon>
          Imágenes

        </button>
      </div>
    </div>

    <!-- === CAMPOS REQUERIDOS (backend) === -->
    <div class="grid-form">
      <!-- Tipo de camión -->
      <div class="campo">
        <label>Tipo de camión: <span class="requerido">*</span></label>
        <select [(ngModel)]="tipoCamion" required>
          <option [ngValue]="null" disabled selected>Selecciona un tipo</option>
          <option *ngFor="let tipo of tiposCamion" [value]="tipo.value">{{ tipo.label }}</option>

        </select>
      </div>

      <!-- Precio -->
      <div class="campo">
        <label>Precio: <span class="requerido">*</span></label>
        <input type="number" min="0" placeholder="Precio del camión" [(ngModel)]="precio" required />
      </div>

      <!-- Moneda -->
      <div class="campo">
        <label>Moneda:</label>
        <select [(ngModel)]="moneda">
          <option value="MXN">MXN - Pesos mexicanos</option>
          <option value="USD">USD - Dólares estadounidenses</option>
        </select>
      </div>

      <!-- Color -->
      <div class="campo">
        <label>Color: <span class="requerido">*</span></label>

        <select [(ngModel)]="color" required>
          <option [ngValue]="null" disabled selected>Selecciona un color</option>
          <option *ngFor="let opcion of colores" [value]="opcion.label">{{ opcion.label }}</option>

        </select>
      </div>

      <!-- Kilometraje - Solo visible para usados/seminuevos -->
      <div class="campo" *ngIf="estadoCamion !== 'Nuevo'">
        <label>Kilometraje: <span class="requerido">*</span></label>
        <input type="number" min="0" placeholder="Ej. 45000" [(ngModel)]="kilometraje" required />
      </div>


      <!-- === CAMPOS OPCIONALES === -->
      <!-- Número de ejes con validación -->

      <div class="campo">
        <label>Número de ejes: <span class="opcional_css">(opcional)</span></label>
        <!-- Reemplazado el input simple con uno con validaciones -->
        <select [(ngModel)]="ejes">
          <option [ngValue]="null" selected>Selecciona una opción</option>
          <option [ngValue]="2">2 ejes</option>
          <option [ngValue]="3">3 ejes</option>
          <option [ngValue]="4">4 ejes</option>
          <option [ngValue]="5">5 ejes</option>
          <option [ngValue]="6">6 ejes</option>
          <option [ngValue]="7">7 ejes</option>
          <option [ngValue]="8">8 ejes</option>
          <option [ngValue]="9">9 ejes</option>
          <option [ngValue]="10">10 ejes</option>
        </select>
      </div>

      <div class="campo">
        <label>Capacidad de carga (toneladas): <span class="opcional_css">(opcional)</span></label>
        <select [(ngModel)]="capacidadCargaToneladas">
          <option [ngValue]="null" selected>Selecciona una opción</option>
          <option [ngValue]="0.5">0.5 toneladas</option>
          <option [ngValue]="1">1 tonelada</option>
          <option [ngValue]="1.25">1.25 toneladas</option>
          <option [ngValue]="1.4">1.4 toneladas</option>
          <option [ngValue]="1.5">1.5 toneladas</option>
          <option [ngValue]="2">2 toneladas</option>
          <option [ngValue]="3.5">3.5 toneladas</option>
          <option [ngValue]="5">5 toneladas</option>
          <option [ngValue]="7.5">7.5 toneladas</option>
          <option [ngValue]="10">10 toneladas</option>
          <option [ngValue]="11">11 toneladas</option>
          <option [ngValue]="14">14 toneladas</option>
          <option [ngValue]="20">20 toneladas</option>
          <option [ngValue]="30">30 toneladas</option>
          <option [ngValue]="50">50 toneladas</option>
          <option [ngValue]="100">100 toneladas</option>
        </select>

      </div>


      <div class="campo">
        <label>Transmisión: <span class="opcional_css">(opcional)</span></label>
        <select [(ngModel)]="transmision">
          <option [ngValue]="null" disabled selected>Selecciona una opción</option>
          <option *ngFor="let tipo of tiposTransmision" [value]="tipo.value">{{ tipo.label }}</option>
        </select>
      </div>

      <div class="campo">
        <label>Combustible: <span class="opcional_css">(opcional)</span></label>
        <select [(ngModel)]="combustible">
          <option [ngValue]="null" disabled selected>Selecciona una opción</option>
          <option *ngFor="let tipo of tiposCombustible" [value]="tipo.value">{{ tipo.label }}</option>
        </select>
      </div>

      <div class="campo">
        <label>Potencia (HP): <span class="opcional_css">(opcional)</span></label>
        <input type="number" min="0" placeholder="Ej. 450" [(ngModel)]="potenciaHP" />
      </div>

      <div class="campo">
        <label>Tipo de cabina: <span class="opcional_css">(opcional)</span></label>
        <select [(ngModel)]="tipoCabina">
          <option [ngValue]="null" disabled selected>Selecciona una opción</option>
          <option *ngFor="let tipo of tiposCabina" [value]="tipo.value">{{ tipo.label }}</option>
        </select>
      </div>

      <div class="campo" style="grid-column: span 2;">
        <label>Descripción del camión: <span class="opcional_css">(opcional)</span></label>
        <textarea rows="4" placeholder="Ej. Camión en excelente estado, único dueño..."
          [(ngModel)]="descripcion"></textarea>
      </div>
    </div>
  </div>
</section>